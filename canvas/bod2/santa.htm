<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1, maximum-scale=1">
<link rel="shortcut icon" sizes="192x192" href="santa.png">
<link rel="apple-touch-icon" href="santa.png">
<style>
html, body { font-family:Sans-serif;border:0;margin:0;height:100%;height:100%; }
</style>
<script src='bod2.js'></script>
<script src='../../conet.js'></script>
<script src='../../menu.js'></script>
<script>
function dataSanta() {
  
  return {
  parts:[[106.0,122.0],[85.0,51.0],[58.0,120.0],[122.0,77.0],[51.0,76.0],[42.0,174.0],[55.0,145.0],[58.0,171.0],[93.0,174.0],[87.0,10.0],[108.0,170.0],[106.0,143.0],[133.0,91.0],[134.0,112.0],[128.0,124.0],[30.0,83.0],[13.0,85.0],[8.0,77.0],[86.0,24.0]],
  pairs:[[1,0],[1,2],[2,0],[3,4],[4,2],[4,1],[4,0],[3,0],[1,3],[3,2],[1,18],[18,9],[3,12],[12,13],[13,14],[4,15],[15,16],[16,17],[0,11],[11,10],[10,8],[2,6],[6,7],[7,5]],
  constraints:[['ac',2,6,7,-2.0,0.1,false],['ac',0,11,10,-2.0,0.1,false],['ac',6,7,5,0.5,2.5,false],['ac',11,10,8,0.5,2.5,false],['ac',0,2,6,-3.0,1.0,false],['ac',2,0,11,-1.0,3.0,false],['ac',4,15,16,-0.1,2.0,false],['ac',15,16,17,-0.1,2.0,false],['ac',3,12,13,-0.1,2.0,false],['ac',12,13,14,-0.1,2.0,false],['ac',1,18,9,-1.0,1.0,false],['ac',4,1,18,-3.0,1.0,false]],
  fcs:[
    ['idle',
      [150,106.0,122.0,85.0,51.0,58.0,120.0,122.0,77.0,51.0,76.0,42.0,174.0,55.0,145.0,58.0,171.0,93.0,174.0,87.0,10.0,108.0,170.0,106.0,143.0,133.0,91.0,134.0,112.0,128.0,124.0,30.0,83.0,13.0,85.0,8.0,77.0,86.0,24.0],
      [150,106.0,122.0,83.0,50.0,58.0,124.0,117.0,77.0,48.0,80.0,40.0,157.0,36.0,137.0,58.0,156.0,89.0,155.0,84.0,10.0,108.0,154.0,90.0,133.0,133.0,86.0,143.0,101.0,136.0,114.0,32.0,74.0,25.0,64.0,26.0,53.0,83.0,24.0]
    ],
    ['run',
      [150,106.0,122.0,85.0,51.0,58.0,120.0,118.0,80.0,51.0,76.0,4.0,148.0,38.0,139.0,18.0,155.0,153.0,153.0,87.0,10.0,145.0,140.0,122.0,137.0,99.0,91.0,83.0,98.0,71.0,89.0,61.0,95.0,66.0,109.0,65.0,118.0,86.0,24.0],
      [150,109.0,111.0,74.0,51.0,58.0,120.0,112.0,67.0,44.0,80.0,42.0,174.0,55.0,145.0,58.0,171.0,87.0,136.0,75.0,11.0,109.0,128.0,85.0,123.0,120.0,85.0,123.0,103.0,121.0,122.0,42.0,100.0,31.0,116.0,19.0,110.0,74.0,24.0],
      [150,106.0,122.0,85.0,51.0,58.0,120.0,118.0,80.0,51.0,76.0,115.0,144.0,78.0,133.0,103.0,136.0,55.0,131.0,87.0,10.0,68.0,140.0,85.0,133.0,132.0,92.0,141.0,104.0,141.0,119.0,30.0,83.0,13.0,85.0,8.0,77.0,86.0,24.0],
      [150,106.0,122.0,101.0,52.0,64.0,109.0,126.0,83.0,65.0,68.0,51.0,130.0,47.0,119.0,67.0,120.0,93.0,174.0,101.0,14.0,108.0,170.0,106.0,143.0,126.0,101.0,124.0,115.0,116.0,125.0,58.0,86.0,49.0,99.0,37.0,99.0,101.0,28.0]
    ]
  ],
  weights:[
   [0,1,[]],
   [1,2,[]],
   [1,0,[]],
   [2,0,[25.977465,0.5225304,1.0]],
   [3,4,[]],
   [4,2,[]],
   [4,1,[-28.411047,0.52442443,1.0]],
   [4,0,[]],
   [3,0,[]],
   [1,3,[]],
   [3,2,[]],
   [2,4,[-30.39054,0.42670026,1.0,31.37812,0.5697734,1.0]],
   [0,3,[33.7941,0.384919,1.0,-30.171806,0.46427006,1.0]],
   [1,18,[-25.612066,-0.40547955,1.0,26.426325,-0.40821913,1.0,-24.057577,1.041096,1.0,25.982183,1.0356166,1.0]],
   [18,9,[0.0,2.9999998,1.0]],
   [3,12,[-7.301526,-0.24921088,1.0,8.481004,-0.30283868,1.0,6.908367,0.76656216,2.0,-6.515208,0.71608883,2.0,-5.8412232,1.4006312,1.0,7.301526,1.2492119,1.0]],
   [12,13,[-4.3284283,-0.32352945,1.0,8.894683,-0.115384586,1.0,7.3250318,0.3167421,2.0,-8.704422,0.30542985,2.0,-9.988681,1.0226244,1.0,7.8958144,0.8868779,1.0]],
   [13,14,[-8.944272,-0.16666666,1.0,8.497058,0.23333357,1.0,11.627553,1.7666668,1.0,-12.969194,2.1,1.0,17.888544,2.1666667,1.0]],
   [4,15,[8.854378,-0.22857147,1.0,-7.2732387,-0.27142864,1.0,7.2732387,0.8428571,2.0,7.589466,1.1714286,1.0,-6.3245554,1.1428573,1.0,-5.6920996,0.8000002,2.0]],
   [15,16,[7.711522,-0.17064846,1.0,-5.433118,-0.19795221,1.0,-6.718372,0.1638226,2.0,7.4194193,0.18430033,2.0,10.34045,0.6348122,1.0,-8.354149,1.3515359,1.0]],
   [16,17,[-9.009982,-0.5280898,1.0,10.599979,0.7977528,1.0,14.203972,2.8089888,1.0,-12.083976,2.550562,1.0]],
   [0,11,[]],
   [11,10,[]],
   [10,8,[]],
   [2,6,[7.029568,-0.32649842,1.0,7.6650085,0.79653,2.0,8.340165,1.2397476,1.0,-11.080507,-0.33280757,1.0,-8.340165,0.7602523,2.0,-8.657887,1.1987382,1.0]],
   [6,7,[]],
   [7,5,[-8.108696,-0.6566037,1.0,7.3715415,0.4150944,1.0,14.681658,1.1433961,1.0,-9.460141,2.2339625,1.0,-11.978755,0.07547161,1.0]],
   [0,2,[]],
   [7,6,[9.857675,1.2642337,1.0,9.857675,1.2642337,1.0,10.354379,0.76204383,2.0,10.736459,0.22189781,1.0,12.341195,-0.24671535,1.0,-9.857671,0.7357664,2.0,-8.367558,1.2291971,1.0,-7.030277,0.33868614,1.0]],
   [3,1,[29.300106,0.34718826,1.0]],
   [11,0,[9.0,1.2380953,1.0,-9.0,1.2857143,1.0,-8.0,0.2857143,2.0,9.0,0.33333334,2.0,10.0,-0.23809524,1.0,-7.0,-0.2857143,1.0]],
   [10,11,[10.637522,0.30422923,1.0,10.674458,-0.17735332,1.0,-9.381704,0.3219645,1.0,-8.495243,0.7639836,2.0,-7.682654,1.1691678,1.0,9.344768,1.1596181,1.0,9.455575,0.71487045,2.0]],
   [8,10,[7.665464,1.6016598,1.0,11.852482,0.86307025,1.0,6.4415665,-1.4439834,1.0,-15.846253,-0.32780123,1.0,-9.597934,0.43153462,1.0]],
  ],
  verts:[[61,45],[48,56],[60,46],[49,57],[44],[47],[58],[5,3],[4],[0],[2],[1],[63],[52],[53],[54],[50,59],[51,62],[81,72],[80],[79],[78],[70],[76,68],[73,69],[74,66],[75,67],[65],[64],[77,71],[10],[8],[9],[6],[7],[42],[43],[39,40],[41,38],[31,37],[30,34],[36,32],[35,33],[28],[29],[26],[22,24],[21,23],[19,16],[20,15],[13,18],[14,17],[12],[11],[27]],
  polys:[
   [200,200,100,[36,38,35]],
   [200,200,100,[36,37,38]],
   [200,200,100,[38,37,41]],
   [200,200,100,[38,41,39]],
   [200,200,100,[39,41,42]],
   [200,200,100,[39,42,40]],
   [200,200,100,[40,42,44]],
   [200,200,100,[40,44,43]],
   [200,200,100,[13,14,17]],
   [200,200,100,[17,14,15]],
   [200,200,100,[17,16,15]],
   [200,200,100,[17,6,16]],
   [200,200,100,[0,2,3]],
   [200,200,100,[17,2,3]],
   [200,200,100,[17,3,6]],
   [200,200,100,[4,0,5]],
   [200,200,100,[1,0,3]],
   [200,200,100,[5,0,1]],
   [255,106,0,[11,7,12]],
   [255,106,0,[12,7,8]],
   [255,106,0,[7,9,8]],
   [255,106,0,[7,10,9]],
   [255,106,0,[11,10,7]],
   [200,200,100,[28,27,25]],
   [200,200,100,[28,25,26]],
   [200,200,100,[25,24,23]],
   [200,200,100,[26,25,23]],
   [200,200,100,[23,24,18]],
   [200,200,100,[23,18,22]],
   [200,200,100,[18,29,22]],
   [200,200,100,[18,21,29]],
   [200,200,100,[18,20,21]],
   [200,200,100,[19,20,18]],
   [200,200,100,[31,33,34]],
   [200,200,100,[31,34,32]],
   [200,200,100,[30,31,32]],
   [200,200,100,[53,52,50]],
   [200,200,100,[53,50,51]],
   [200,200,100,[51,50,48]],
   [200,200,100,[51,48,49]],
   [200,200,100,[48,47,49]],
   [200,200,100,[48,46,47]],
   [200,200,100,[46,45,47]],
   [200,200,100,[46,54,45]],
  ],
  }
  
  
  
  //...
}
function onload() {
  //---
  var img,mleft,mright;
  Conet.download({fn:'santa.json.txt',f:function(v) {
    var d=JSON.parse(v);
    img=new Image();
    img.src=d.data;
    console.log(d.tridata);
    
    
    var i1=[4,5,0,    1,3,2,    6,16,15,17,  14,13,
            27,28,25, 26,23,24, 22,29,21,18, 20,19, 30,31,32,33,34, 35,36,37,38, 39,40,41,42, 43,44,   54,45,47,46, 48,50,49,51, 52,53];
    var i0=[3,4,5,    6,8,7,    10,11,12,9,  13,14,
            3,4,5,    6,8,7,    10,11,12,9,  13,14, 19,17,18,15,16, 29,28,26,27, 25,23,24,22, 21,20,   29,28,26,27, 25,23,24,22, 21,20];
    
    
    for (var i=0;i<i0.length;i++) {
      var v=d.tridata.verts[i0[i]],w=u.verts[i1[i]];
      w.u=v[0];w.v=v[1];
    }
    
    u.dbg=0;
    var v;
    v=u.verts[7];v.u=0.36;v.v=0.46;
    v=u.verts[11];v.u=0.05;v.v=0.1;
    v=u.verts[10];v.u=-0.05;v.v=0.6;
    
    v=u.verts[12];v.u=0.6;v.v=0.1;
    v=u.verts[8];v.u=0.7;v.v=0.6;
    v=u.verts[9];v.u=0.3;v.v=0.8;
    
    if (!u.dbg) for (var i=u.polys.length-1;i>=0;i--) u.polys[i].img=img;
    
    
  }
  });
  
  var bod2=new Bod2();
  var u=bod2.loadUnit(dataSanta());
  bod2.init();
  bod2.setFc(u,'idle');
  
  
  bod2.extCalc=function(dt) {
    
    //var mx=0,my=0;
    //for (var i=u.parts.length-1;i>=0;i--) {
    //  var p=u.parts[i];//pa[i];
    //  mx+=p.x0;my+=p.y0;
    //}
    //mx/=u.parts.length;my/=u.parts.length;
    var mx=u.mx,my=u.my;
    //Bod2.display="Unit.m="+(int)mx+" "+(int)my;
    if (!u.currentFc) {
      //---
      var d=(mx-u.omx)*(mx-u.omx)+(my-u.omy)*(my-u.omy);
      if (d<0.5) bod2.setFc(u,u.fch['up']?'up':'idle');
      u.omx=mx;u.omy=my;
      return;
    }
    if (u.currentFc.name=='up') {
      if (!u.currentFc.first) bod2.setFc(u,'idle');
    }
    
    var fcn=u.currentFc.name;
    if (mleft.on) { if (u.mirror||(fcn!='run')) { u.mirror=false;bod2.setFc(u,'run'); }} else
    if (mright.on) { if (!u.mirror||(fcn!='run')) { u.mirror=true;bod2.setFc(u,'run'); }} else
    if (fcn!='idle') bod2.setFc(u,'idle');
    
    if ((mx>20)&&(mx<100)&&(my>450)&&(my<500)) if (u.parts.length>12) { //30,50,470,490
      var dx=-25;
      var dy=50;
      var p3=u.parts[3],p2=u.parts[2],
          pa0=u.parts[9],pa3=u.parts[12];
      p3.x1=p3.x0+dx;p3.y1=p3.y0+dy;
      p2.x1=p2.x0+dx;p2.y1=p2.y0+dy;
      pa0.x1=pa0.x0+dx;pa0.y1=pa0.y0+dy;
      pa3.x1=pa3.x0+dx;pa3.y1=pa3.y0+dy;
      bod2.setFloating(u);
    }
    
    
  }
  
  Menu.init([
  mleft={s:'\u2190',px:0.02,py:0.02,pw:0.116,ph:0.116,ydown:true,fs:1.4,keys:[65,37]},
  mright={s:'\u2192',px:0.88,py:0.02,pw:0.116,ph:0.116,ydown:true,fs:1.4,keys:[68,39]}
  ],{listen:1});
  Menu.draw();
}
</script>
</head>
<body bgcolor="#aaa" onload="onload();">
<canvas id="canvas" width="500" height="600"></canvas>
</body>
</html><script>
//fr o,13
//fr o,14
//fr p,6,22
